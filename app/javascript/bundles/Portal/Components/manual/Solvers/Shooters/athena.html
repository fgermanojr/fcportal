<html>
<head>
   <title>Solver ATHENA</title>
   <style>
       tr { vertical-align: top; }
   </style>
</head>
<body text="#000066">
<h1 align=center>Solver ATHENA</h1>

<P>Integration solver ATHENA is identical to MINERVA in all but one respect.  ATHENA 
has the additional capability to propagate the evaluation of partial 
derivatives and thus may be nested within calculus processes, for 
example in boundary value or process identification problems.  In 
all other respects, the description of MINERVA applies equally to 
ATHENA.  Both offer the same options, have the same control variables, 
and invoke the same integration techniques. The additional capability 
of ATHENA, however, is achieved at a cost of slightly slower execution speed. Thus, 
unless derivative evaluation is in progress, MINERVA should always 
be used in preference to ATHENA.</p>

<p></p>One point which bears particular emphasis is that, if ATHENA is nested 
within a calculus process, its INITIATE statement should not be executed 
within the calculus model.  Instead it should be performed before 
the calculus process is begun.  This is the exact opposite of the 
rule for ISIS, which is one key reason why ATHENA is more efficient 
than ISIS.</p>

<P>Like solver MINERVA, ATHENA has the following distinguishing features:</P>

<UL>
<LI>It employs a true single-step integration method, with no  use 
whatsoever of information from prior steps.  This has  several important 
consequences, described in Section 5.8.</LI>

<LI>It offers Runge-Kutta methods of orders 2, 3, 4, and 5.   The 
first three of these options are special formulations  designed to 
minimize the local truncation error, i.e. the  principal part of the 
error incurred in one step.  The  fifth order method offers both high 
precision and an  extended domain of stability.</LI>

<LI>Limits may be imposed upon the dependent variables of  integration.  The 
applications of such limits and examples  of their use are described  below.  These 
examples  should be carefully reviewed before using the limiting  feature.</LI>
</UL>


<A NAME="INITIATE" ID="INITIATE"><H2>ATHENA INITIATE Statement</H2></A>

<P>The INITIATE statement for ATHENA is:<BR>

<blockquote>
<B>INITIATE ATHENA</B> {<B>(</B><I>controller</I><B>)</B>}<B>;</B> 
{<B>WITH</B>}<B>FLAG</B> <I>signal</I><B>;</B>} <br>
{{<B>AND</B>|<B>WITH</B>} <B>LOWER</B>{<B>S</B>}<I> bottoms</I><B>;</B>} {{<B>AND</B>|<B>WITH</B>} 
<B>UPPER</B>{<B>S</B>}<I> tops</I><B>;</B>}<BR>
<B>FOR</B> <I>model</I><B>;</B> <B>EQUATIONS</B> <I>ode/vars</I><B>; OF</B>
<I>ind-var</I><b>;</b> <B>STEP</B> <I>delta</I><B>; TO</B> <I>limit</I>
</blockquote>

<P>With the exception of the clauses pertaining to limiting, the meaning 
and use of the elements of this statement are identical to those described 
for JANUS in Section 5.1.1.  As usual,  the optional clauses may be 
input in any order.  The remaining mandatory  clauses must be given 
in the prescribed sequence.</P>

<P>The UPPERS and LOWERS clauses permit the imposition of limits, i.e. 
fixed bounds upon the dependent (state) variables.  Either or both 
types of limits may be used; but if a given type is present, there 
must be a limit for every dependent variable.  This is required because 
each entry in the list of limits is associated with its dependent 
variable by matching the <I>bottoms</I> or <I>tops</I>  list with 
the <I>ode/vars</I> list in a left-to-right order.  As usual with 
lists of variables in INITIATE statements, the <I>bottoms</I> and 
<I>tops</I> must be variables (not constants) and they may be any 
combination of scalars, array elements, array parts and entire arrays.  For 
the purpose of association, list entries taken from arrays are extracted 
column by column.</P>

Sample INITIATE statements are:

<PRE>
      INITIATE ATHENA;  WITH UPPER HIVAL;  AND FLAG TESTF;
     ~   FOR ONE;  EQUATION DY/Y;  OF T;  STEP DT;  TO TFINAL           

      INITIATE ATHENA(SETUP); WITH UPPERS HI1,HI2;
     ~   AND LOWERS LO1,LO2; FOR TWO; EQUATIONS DE/A,DB/B;
         OF C; STEP DELC;  TO ENDC                     

      INITIATE ATHENA; FOR MANY; EQUATIONS DV/V;
     ~   OF T; STEP DELTA; TO TF
</PRE>     

<P>The optional flag may be used to determine which equation was limited.  After 
the integrate statement has been executed, the flag variable will 
have a value of zero if there was no limiting required while integrating 
up to <I>limit</I>.  Otherwise, it will contain the number of the 
equation which required limiting, counting from left to right in the 
<I>ode/vars</I> list.  If limiting is not imposed, the flag is ignored 
and its value will remain unchanged.  When two variables limit simultaneously, 
the leftmost one in the <I>ode/vars</I> list is flagged.</P>

<A NAME="CONTROLS" ID="CONTROLS"><H2>ATHENA Controls</H2></A>

The control variables for ATHENA are:

<DIV STYLE="indented"><hr>
<TABLE>
<TR>
<TH ALIGN=LEFT>Variable</TH>
<TH ALIGN=LEFT>Description</TH>
<TH ALIGN=RIGHT>Preset Value</TH>
</TR>

<TR WIDTH=100%>
<TD VALIGN=TOP WIDTH=15%><B>EPSILON</B></TD>
<TD><b>Limiting convergence criterion.</b><BR>
If the equations are integrated to a point at which any further steps would be less in 
absolute magnitude than EPSILON, then the limit has been reached and integration halts.
If EPSILON is zero, then it is automatically set to the input step size times 0.001.
</TD>
<TD VALIGN=TOP>0.001</TD>
</TR>

<TR WIDTH=100%>
<TD VALIGN=TOP><B>BOUND</B></TD>
<TD><B>Type of limiting option.</B><BR>
Zero selects normal limiting and nonzero selects absolute limiting.</TD>
<TD VALIGN=TOP>0</TD>		
</TR>                                                            

<TR WIDTH=100%>
<TD VALIGN=TOP><B>ORDER</B></TD>
<TD><B>Selector for the Runge-Kutta order.</B><BR>
The formulations are Heun (Order 2), Kuntzmann (orders 3 and 4), and Lawson (order 5).</TD>
<TD VALIGN=TOP>3</TD>	
</TR>

</TABLE><HR></DIV>		      								

<H4>Examples of Integration Output Limiting with ATHENA</H4>

<P>The following examples illustrate two common uses of limiting.</P> 

<P>The first example is a system of two equations representing a growth/decay 
model in which the growth curve has an upper limit ...</P>

&nbsp;&nbsp;&nbsp;&nbsp;<I>dy<SUB>1</SUB>/dt = y<SUB>1</SUB><BR> 

&nbsp;&nbsp;&nbsp;&nbsp;dy<SUB>2</SUB>/dt = -y<SUB>2</SUB></I><BR><BR> 

where y<SUB>1</SUB> has a maximum value of 5. The analytical solution 
of these equations is y<SUB>1</SUB>=exp(t) and y<SUB>2</SUB>=exp(-t). This 
system may be integrated from t=0 to t=10 by the following program:</P>


<PRE>
      PROBLEM DEMO
        COMMON DY1,Y1,DY2,Y2,TLIM
        Y1=1 : Y2=1    !Establish initial conditions
        T=0 : TLIM=0.0 : DT=0.05 : TFINAL=10 : HY1=5 : HY2=1E10
        INITIATE ATHENA; WITH UPPERS HY1, HY2; FOR SYSTEM;
     ~    EQUATIONS DY1/Y1,DY2/Y2 OF T; STEP DT; TO TFINAL
        INTEGRATE SYSTEM; BY ATHENA
        ! Now test if a limit occurred before TFINAL
        DO WHILE (T.LT.TFINAL)
          TLIM=T               ! Set up new model conditions
          INTEGRATE SYSTEM; BY ATHENA ! and finish integration
        END DO
        ! Generate final output
        PRINT *,'Y1=',Y1,'Y2=',Y2,'AT T=',T
        IF (TLIM.NE.0.0) THEN
          PRINT *,'Y1 LIMITED AT T=',TLIM
        ENDIF
      END

      MODEL SYSTEM
        COMMON DY1,Y1,DY2,Y2,TLIM
        DY2=-Y2
        IF (TLIM.EQ.0.0) THEN
          DY1=Y1
        ELSE
          DY1=0
        ENDIF
      END
</PRE>      
      
<P>The output of this program is :</P>

</PRE> 
     Y1 = 5.00E+00 AND Y2 = 4.54E-05 AT T = 10.00
     Y1 LIMITED AT T = 1.61

<P>Note how the limits were imposed.  Whenever there are any limits, 
they must be given for every equation.  In this case, the limit for 
y<SUB>2</SUB> was set essentially at infinity.</P>

<P>The second example is a modification of the first in which limiting 
is also used to obtain output information at prescribed values of 
one of the dependent variables, i.e. at each decade drop in y<SUB>2</SUB>.  For 
this case, lines 5 through 12 are rewritten as follows:</P>

<PRE>
      INITIATE ATHENA; WITH UPPERS TOP1,TOP2; AND LOWERS BOT1,BOT2;
     ~  WITH FLAG PICK; FOR SYSTEM; EQUATIONS DY1/Y1,DY2/Y2;
     ~  OF T; STEP DT; TO TFINAL
        BOT1=1E-9 : BOT2=0.1
        DO WHILE (T.LT.TFINAL)
          INTEGRATE SYSTEM: BY ATHENA
          IF(PICK.EQ.1.0) THEN ! Limit stop on Y1
            TLIM=T
          ELSEIF(PICK.EQ.2.0) THEN  ! Print stop on Y2
            PRINT *, 'Y1=',Y1,'Y2=',Y2,'AT T=',T
            BOT2=BOT2/10.0
          ENDIF
        END DO
</PRE>

<P>The output of the modified program then becomes:</P>

<PRE>
      Y1 = 5.00E+00 AND Y2 = 1.00E-01 AT T =  2.30
      Y1 = 5.00E+00 AND Y2 = 1.00E-02 AT T =  4.61
      Y1 = 5.00E+00 AND Y2 = 1.00E-03 AT T =  6.91
      Y1 = 5.00E+00 AND Y2 = 1.00E-04 AT T =  9.21
      Y1 = 5.00E+00 AND Y2 = 4.54E-05 AT T = 10.00
      Y1 LIMITED AT T = 1.61
</PRE>

<P>A final example shows how "constant" limits may be generalized by 
introducing additional dependent variables.  In a pursuit problem, 
the two independent trajectories are integrated until the vehicles 
are 'close', at which time the pursuit phase is over.  A program which 
solves this problem is:</P>

<PRE>
      PROBLEM PURSUIT
        COMMON/VARS/Y1,Y2,Y3,DY1,DY2,DY3
        DIMENSION FLOOR (3)
        DATA FLOOR/-1E200,-1E200,0.005/  ! Set lower limit on Y3=Y2-Y1
        Y1=0: Y2=2: Y3=2: T=0: DT=0.5: TF=10  ! Set initial conditions
        INITIATE ATHENA; WITH LOWERS FLOOR; FOR CHASE;
     ~    EQUATIONS DY1/Y1,DY2/Y2,DY3/Y3; OF T; STEP DT; TO TF
        INTEGRATE CHASE; BY ATHENA  ! Until Y3 reaches limit
        PRINT *, 'PROXIMITY=',Y3,'AT T=',T
      END

      MODEL CHASE
        COMMON/VARS/Y1,Y2,Y3,DY1,DY2,DY3
        DY1=1+Y1 ! Solution is Y1=EXP(T)-1
        DY2=1-Y2 ! Solution is Y2=EXP(-T)+1
        DY3=DY2-DY1 ! Solution is Y3=Y2-Y1
      END
</PRE>

<P>The result is:</P>

<PRE>
      PROXIMITY=0.0050 AT T=0.8796
</PRE>

<P>Some points to remember while using limiting are as follows:</P>

<UL>

<LI>When limiting is required for some equations and not for  others, 
there are two feasible approaches.  The required  limits are defined 
for the constrained equations and for  the remainder either: 

  <ul>

  <li>use a limit which is completely out-of-range of the  equations, 
      or</li> 

   <li>use both upper and lower limits and overlap them.  In this 
   case they will be ignored.</li>
   </ul>
</LI>

<LI>The values of the limit variables may be changed between 
executions of the INTEGRATE statement without any  requirement to 
re-initiate the solver.  However, the limit variable cannot be changed 
in the integration model itself  i.e. the value when the INTEGRATE 
statement is executed  prescribes the limit.</LI>

<LI>When a limit is reached, integration halts with the limited  variable 
set slightly below the upper limit (or above the  lower limit).  How 
near it is depends upon the solver  control variable EPSILON, but 
it will usually be within 0.0001 relative at the preset value.  If 
a variable is set  exactly to the limit, subsequent integration will 
promptly  halt, flagging that a limit has been reached.  Thus, never  set 
a variable precisely to the limit i.e. always a small amount away 
(at least 10<SUP>-8</SUP>).</LI>

<LI>If any variable has an out-of-range initial condition,  integration 
cannot proceed and a fatal execution error  occurs (with a suitable 
diagnostic).  Hence, when  initiating integration on the basis of 
calculated  conditions, as in a boundary value or optimal control  problem, 
always make limit tests before attempting to  proceed.</LI>

<LI>The "current" step size after a limit is reached is the 
value before the specially reduced step required to move to the limit.</LI>
</UL>

</BODY></HTML>
